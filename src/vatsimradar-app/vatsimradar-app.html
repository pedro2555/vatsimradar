<!--
Copyright (C) 2017  Pedro Rodrigues <prodrigues1990@gmail.com>

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="vatsimradar-app">
  <template>
    <style>
      :host {
        display: block;
      }

      google-map {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
      }
    </style>

    <iron-ajax
          auto
          id="ajax"
          url="{{pilotsUrl}}"
          handle-as="json"
          last-response="{{pilots}}"
          on-response="handleResponse"></iron-ajax>

    <google-map
          fit-to-marker
          api-key="AIzaSyDj4y39JAORYGw4rNcA1y8oVj0m8lNDje4"
          latitude="40.0955474"
          longitude="-3.070306"
          zoom="4">

      <template is="dom-repeat" items="[[pilots]]">
        <google-map-marker latitude="[[item.latitude]]" longitude="[[item.longitude]]"
            draggable="false" title="[[item.callsign]]" icon="./light-aircraft.png"></google-map-marker>
      </template>

    </google-map>

  </template>

  <script>
    Polymer({

      is: 'vatsimradar-app',

      properties: {
        pilotsUrl: {
          type: String,
          value: 'https://jsonp.afeld.me/?url=http://api.vateud.net/online/pilots/lp,me.json',
        },
      },
      handleResponse: function() {
        this.async(function() {
          //console.log(this.$.ajax.url);
          this.$.ajax.url = this.pilotsUrl + '?' + Math.random();
          this.$.ajax.generateRequest();
        }, 5000);
      }

    });
  </script>
</dom-module>
